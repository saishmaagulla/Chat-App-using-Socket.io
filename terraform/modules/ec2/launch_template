resource "aws_placement_group" "dev_pg" {
	name = var.env
	strategy = "spread"
}

resource "aws_launch_template" "dev_launch_template" {
	name = "app_launch_template"
	
	block_device_mappings {
	device_name = "/dev/sda1"
	ebs {
	volume_size = 10
	volume_type = "gp2"
	}
	}
	
	#capacity_reservation_specification {
	#capacity_reservation_preference = "open"
	#}
	
#	cpu_options {
#	core_count = 2
#	threads_per_core = 2
#	}
	
	#credit_specification {
	#cpu_credits = "standard"
	#}
	
	disable_api_termination = false
	
	ebs_optimized = true
	
		
	#iam_instance_profile {
	#name = "test"
	#}
	
	image_id = var.ami_id
	
	instance_initiated_shutdown_behavior = "terminate"
	
	#instance_market_options {
	#market_type = "spot"
	#}
	
	instance_type = var.instance_type
	
#	kernel_id = "test"
	
	key_name = var.key_name
	
	#license_specification {
	#license_configuration_arn = var.license_arn
	#}
	
	metadata_options {
	http_endpoint = "enabled"
	http_tokens = "required"
	http_put_response_hop_limit = 1
	}
		
	monitoring {
	enabled  = false
	}
	
	network_interfaces {
	associate_public_ip_address = true
	delete_on_termination = true
	security_groups = [ var.sg_id ]
	subnet_id = var.subnet_id_one
	}
	
	placement {
	group_name = aws_placement_group.dev_pg.id	
	availability_zone = element(var.availability_zones, 0)
	}
	
	
	#vpc_security_group_ids = [var.sg_id]
	
	tag_specifications {
	resource_type = "instance"
	
	tags = {
	Name= var.env
	}
	}
        depends_on = [var.subnet_id_one,
	var.sg_id
	]
}
